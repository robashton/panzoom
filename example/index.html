<html>
  <head>
    <script src="lib/jquery.js" type="text/javascript"></script>
    <script src="../panzoom.js" type="text/javascript"></script>
    <script src="lib/hammer.js" type="text/javascript"></script>
  </head>
  <body>
    <img src="image.jpg" width="360" height="240"/>

    <script type="text/javascript">
      $(function() { 
        var $img = $('img')
        var zoomed = false

        var zoomer = $img.panzoom() 

        var hammer = new Hammer($img.get(0))
        hammer.ondoubletap = function(e) {
          var imagePosition = zoomer.screenToImage(e.position[0].x, e.position[0].y)

          if(zoomed) {
            zoomer.reset()
          } else {
            zoomer.zoomTo(4.0)
            zoomer.panTo(imagePosition.x, imagePosition.y)
          }
          zoomed = !zoomed
        }

        var dragTimer = null
        var lastDrag = {
          x: 0,
          y: 0
        }
        var currentDrag = {
          x: 0,
          y: 0
        }
        function updateDrag() {
          var x = lastDrag.x - currentDrag.x
          var y = lastDrag.y - currentDrag.y 
          lastDrag.x = currentDrag.x
          lastDrag.y = currentDrag.y
          zoomer.pan(x, y)
        }

        hammer.ondragstart = function(e) {
          lastDrag.x = 0
          lastDrag.y = 0
          dragTimer = setInterval(updateDrag, 20)
        }
        hammer.ondrag = function(e) {
          currentDrag.x = e.distanceX
          currentDrag.y = e.distanceY
        }

        hammer.ondragend = function() {
          clearInterval(dragTimer)
          updateDrag()
        }
      })  
    </script>
  </body>
</html>

